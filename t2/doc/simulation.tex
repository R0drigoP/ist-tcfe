\newpage

\section{Simulation Analysis}
\label{sec:simulation}

For the circuit simulation we used the \textit{Ngspice} software. It is important to point that, for this analysis we needed to add an independent voltage source with value 0V to compute the current $I_d$, needed on the dependent voltage source.

\subsection{Operating Point Analysis for $t<0$}
\label{subsec:op_point}

In this period of time, $v_s (t)= V_s$ and the circuit is time static, which means that the Capacitor C behaves as an open circuit. 

Table \ref{tab:sim1} shows the node voltages obtained using the simulated operating point results for the circuit under analysis, for $t<0$.
\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline    
    {\bf Variable} & {\bf Value [V or A]} \\ \hline
    \input{../sim/OP_tab}
  \end{tabular}
  \caption{Node voltage and branch current obtained by the simulation analysis.}
  \label{tab:sim1}
\end{table}

Compared to the theoretical analysis results, we notice that both are similar, having small numeric differences between them. The most likely cause of this is due to the fact that \textit{Octave} and \textit{Ngspice} have different numerical precision.

\newpage

\subsection{Finding the initial conditions of the circuit}
\label{subsec:init_conds}

Before we begin transient analysis, we need to find the intinial conditions of the original circuit at the capacitor terminals, $V_6$ and $V_8$. For that, we follow the same steps as in Subsection \ref{subsec:Req}.
\par
The results for the Operating Point Analysis are represented in Table \ref{tab:sim2}.

\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline
    {\bf Variable} & {\bf Value (V)} \\ \hline
    \input{../sim/OP1_tab}
  \end{tabular}
  \caption{Node voltage and branch current obtained by the simulation analysis.}
  \label{tab:sim2}
\end{table}

\newpage

\subsection{Transient Analysis - Natural Solution}
\label{subsec:trans_NS}

We begin by  analysing the original circuit in the interval $t \in [0, 20]ms$, with no forced frequency, that means, we make $V_s$ = 0V.
For this analysis, we used the boundary conditions for $V_6$ and $V_8$ obtained in the previous section, with the AC Independent Voltage Source $V_s$ following a sinusoidal signal. The result of the Transient Analysis is shown in Figure \ref{fig:sim-graph3}.

\begin{figure}[H] \centering
\includegraphics[width=0.7\linewidth]{../sim/vn.pdf}
\caption{Simulated Natural Solution.}
\label{fig:sim-graph3}
\end{figure}

As expected, the voltage of $V_6$ decays exponentially, as the Capacitor stores more and more energy as time goes by, which was also seen in Section \ref{sec:analysis}.

\subsection{Transient Analysis - Forced Frequency of 1kHz}
\label{subsec:trans_FS}

In this section, we repeat the exact same steps taken in the previous one, except we introduce a forced frequency signal of 1kHz on $V_s$. In Figure \ref{fig:sim-graph4}, we can observe the sum of both the natural and forced response of the circuit in node 6.


\begin{figure}[H] \centering
\includegraphics[width=0.7\linewidth]{../sim/vt.pdf}
\caption{Simulated Total and Forced solution.}
\label{fig:sim-graph4}
\end{figure}

It is clear that the shape of $V_6(t)$ is the same as before, only now modulated by the stimulus, represented in Figure \ref{fig:sim-graph4} in blue, with the label v(1), because the voltage in node 1 is made up of a difference in potencial in the GROUND (that has voltage 0) and by the voltage created by $V_s$. Once again, this is the same as obtained in the theorethical analysis.

\subsection{Frequency Analysis}
\label{subsec:sim_freq}

We now look at the original circuit in a range of forced frequencies of 0.1Hz to 1MHz. In Figure \ref{fig:sim_db}, we can observe the Amplitudes of $V_6$, $V_s$ and $V_c$ in dB, respectively represented by db(v(6)), db(v(1)) and db(v(6) - v(8)), as a function of the logarithm of the ranges of frequencies previously mentioned.

\begin{figure}[H] \centering
\includegraphics[width=0.7\linewidth]{../sim/db.pdf}
\caption{Simulated Frequency Response: Magnitude.}
\label{fig:sim_db}
\end{figure}

The first thing to notice is that the amplitude of $V_s$ is always zero. This happens because $V_s$ is the voltage source, so it mantains its amplitude constant throughout frequency changes, unlike $V_6$. It is zero because the amplitude would be 1 in Volts, but, transforming the units into dB, we have to do the base 10 logarithm of the amplitude in Volts, which results in an amplitude in dB of zero. Also, $V_6$ starts at being constant and ends like that too, because at low frequencies the capacitor acts as an open circuit and for high frequencies, it acts as a short circuit.
\par
Lastly, we take a look at the phase of $V_6$, $V_s$ and $V_c$, respectively ph(v(6)), ph(v(1)) and ph(v(6) - v(8)), as a function of the same range of frequencies in Figure \ref{fig:sim_ph}.

\begin{figure}[H] \centering
\includegraphics[width=0.7\linewidth]{../sim/ph.pdf}
\caption{Simulated Frequency Response: Phase.}
\label{fig:sim_ph}
\end{figure}


As we can observe, all of the phases are 0 at $f=0.1Hz$ and then vary according to the frequency.
\par
Both of this results were also obtained in Section \ref{sec:analysis}.











